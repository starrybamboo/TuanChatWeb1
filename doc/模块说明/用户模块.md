# 用户模块说明

## 概述

用户模块是TuanChat平台的基础功能模块，负责用户账号的注册、登录、信息管理等核心功能。该模块与角色模块紧密集成，为用户提供身份认证和角色管理的基础支持，是平台其他功能模块的重要依赖。

## 数据模型

### 用户信息响应 (UserInfoResponse)

```typescript
export type UserInfoResponse = {
    userId: number;       // 用户ID
    nickname?: string;    // 用户昵称
    avatarUrl?: string;   // 用户头像URL
    roles?: UserRole[];   // 用户拥有的角色列表
    createTime?: string;  // 创建时间
    updateTime?: string;  // 更新时间
};
```

### 登录请求 (LoginRequest)

```typescript
export type LoginRequest = {
    userId: number;       // 用户ID
    password: string;     // 用户密码
};
```

### 注册请求 (RegisterRequest)

```typescript
export type RegisterRequest = {
    nickname: string;     // 用户昵称
    password: string;     // 用户密码
};
```

## 功能模块

### 用户认证

- 用户登录功能
- 用户注册功能
- 令牌（Token）管理
- 会话状态维护

### 用户信息管理

- 获取用户基本信息
- 更新用户个人资料
- 修改密码功能
- 头像上传与管理

### 角色关联管理

- 获取用户拥有的角色列表
- 用户与角色的关联与解除
- 角色权限管理
- 默认角色设置

### 用户偏好设置

- 界面主题设置
- 通知偏好设置
- 隐私设置管理
- 语言偏好设置

## 界面设计

### 登录/注册界面

登录/注册界面采用对话框形式，包含：

- 登录表单（用户ID、密码）
- 注册表单（昵称、密码）
- 表单验证与错误提示
- 切换登录/注册的按钮

### 用户个人中心

用户个人中心页面分为多个区域：

- 头部：用户基本信息、头像展示
- 主体：个人资料编辑区域
- 侧边：功能导航菜单
- 底部：操作按钮区域

### 角色管理界面

角色管理界面与角色模块集成，提供：

- 用户拥有的角色列表
- 角色创建与编辑入口
- 角色权限管理功能
- 角色切换功能

## 技术实现

### 前端组件

- 登录对话框组件 (LoginDialog)
- 用户信息展示组件 (UserInfo)
- 用户设置表单 (UserSettingsForm)
- 头像上传组件 (AvatarUploader，与角色模块共用)

### API接口

- 用户登录：POST /api/user/login
- 用户注册：POST /api/user/register
- 获取用户信息：GET /api/user/{id}
- 更新用户信息：PUT /api/user/{id}
- 修改密码：POST /api/user/password
- 上传用户头像：POST /api/user/{id}/avatar

### 状态管理

使用Pinia进行状态管理，创建专门的用户状态存储：

```typescript
// 用户状态存储示例
export const useUserStore = defineStore('user', () => {
  const token = ref<string | null>(localStorage.getItem('token'))
  const userInfo = ref<UserInfoResponse | null>(null)

  const setToken = (newToken: string | null) => {
    token.value = newToken
    if (newToken) {
      localStorage.setItem('token', newToken)
    } else {
      localStorage.removeItem('token')
    }
  }

  const setUserInfo = (info: UserInfoResponse | null) => {
    userInfo.value = info
  }

  const clearUserInfo = () => {
    setToken(null)
    setUserInfo(null)
  }

  return {
    token,
    userInfo,
    setToken,
    setUserInfo,
    clearUserInfo
  }
})
```

## 与角色模块的集成

用户模块与角色模块紧密集成，主要体现在：

1. 用户信息中包含用户拥有的角色列表
2. 登录成功后可以获取并加载用户的角色信息
3. 角色创建和管理需要用户身份验证
4. 用户可以在不同角色间切换进行操作

## 安全考虑

### 认证安全

- 密码加密存储
- 令牌（Token）基于JWT实现
- 会话超时自动登出
- 防止暴力破解的限流措施

### 数据安全

- 敏感信息传输加密
- 用户数据访问权限控制
- 个人信息保护措施
- 数据备份与恢复机制

## 未来规划

### 短期计划

- 完善用户注册功能实现
- 增强密码安全策略
- 添加第三方登录支持
- 优化用户体验和界面设计

### 中期计划

- 实现用户关系系统（好友、关注等）
- 添加用户活动日志和历史记录
- 开发用户成就和积分系统
- 实现多设备同步登录

### 长期计划

- 用户社区和互动功能
- 高级会员和订阅系统
- 用户行为分析和个性化推荐
- 全平台账号体系整合